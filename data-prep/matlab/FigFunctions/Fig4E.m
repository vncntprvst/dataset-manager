%Fig4E.m
% Dynamic Table

function Fig4E(subj_figs,summary_data_path,nwb)
    clearvars -except subj_session_id summary_data_path subj_figs primary_experiments_table subj nwb output_path
    if contains(subj_figs,' 4e')
    
        Coh = readtable(strcat(summary_data_path, '\IndividualFigures\Fig4\E\StimRegionCoherence.csv'));
        CohBins = readtable(strcat(summary_data_path, '\IndividualFigures\Fig4\E\StimRegionCoherence_BinEdges.csv'));
    
        restC = Coh.restC;
        stimC = Coh.stimC;
        Edges = CohBins.binEdges;
        %Create dynamic table
        col1 = types.hdmf_common.VectorData( ...
            'description', 'Resting State Magnitude Coherence', ...
            'data', restC);
        col1_len = length(col1.data);
        col2 = types.hdmf_common.VectorData( ...
            'description', 'Stimulated Magnitude Coherence', ...
            'data', stimC);
        table_4E_Coh = types.hdmf_common.DynamicTable( ...
            'description', 'analysis table', ...
            'Resting State Magnitude Coherence', col1, ...
            'Stimulated Magnitude Coherence', col2, ...
            'id', types.hdmf_common.ElementIdentifiers('data', linspace(1,col1_len,col1_len)) ...
            );
        nwb.analysis.set('PiaRestStimCoherence4E', table_4E_Coh);
        %Create dynamic table
        col1 = types.hdmf_common.VectorData( ...
            'description', 'Histogram Bin Edges', ...
            'data', Edges);
        col1_len = length(col1.data);
        table_4E_BinEdges = types.hdmf_common.DynamicTable( ...
            'description', 'analysis table', ...
            'Bin Edges', col1, ...
            'id', types.hdmf_common.ElementIdentifiers('data', linspace(1,col1_len,col1_len)) ...
            );
        nwb.analysis.set('PiaRestStimCoherenceEdges4E', table_4E_BinEdges);
    end
end