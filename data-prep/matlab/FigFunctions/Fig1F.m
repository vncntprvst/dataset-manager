%Fig1F.m
% Dynamic Table

function Fig1F(subj_figs,summary_data_path,nwb)
    clearvars -except subj_session_id summary_data_path subj_figs primary_experiments_table subj nwb output_path
    if contains(subj_figs,' 1f')
    
        traces_tbl = readtable(strcat(summary_data_path, '\IndividualFigures\Fig1\F\FluxModExample_Traces_1F.csv'));
        edges_tbl = readtable(strcat(summary_data_path, '\IndividualFigures\Fig1\\F\FluxModExample_Edges_1F.csv'));
    
        phase_trace = traces_tbl.phase_trace;
        flux_trace = traces_tbl.flux_trace;
        phase_edges = edges_tbl.phase_edge;
        flux_edges = edges_tbl.flux_edge;
    
        %Assign to dynamic table: Pia
        col1 = types.hdmf_common.VectorData( ...
            'description', 'phase trace (rad)', ...
            'data', phase_trace);
        col1_len = length(col1.data);
        col2 = types.hdmf_common.VectorData( ...
            'description', 'flux trace (Hz)', ...
            'data', flux_trace);
        table_1F_Traces = types.hdmf_common.DynamicTable( ...
            'description', 'analysis table', ...
            'phase trace', col1, ...
            'flux trace', col2, ...
            'id', types.hdmf_common.ElementIdentifiers('data', linspace(1,col1_len,col1_len)) ...
            );
        table_1F_Traces;
        nwb.analysis.set('FluxModulationJointDistributionTraces1F', table_1F_Traces);
    
        %Assign to dynamic table
        col1 = types.hdmf_common.VectorData( ...
            'description', 'phase bin edges (rad)', ...
            'data', phase_edges);
        col1_len = length(col1.data);
        col2 = types.hdmf_common.VectorData( ...
            'description', 'flux bin edges (Hz)', ...
            'data', flux_edges);
        table_1F_BinEdges = types.hdmf_common.DynamicTable( ...
            'description', 'analysis table', ...
            'phase bin edges', col1, ...
            'flux bin edges', col2, ...
            'id', types.hdmf_common.ElementIdentifiers('data', linspace(1,col1_len,col1_len)) ...
            );
        table_1F_BinEdges;
        nwb.analysis.set('FluxModulationJointDistributionEdges1F', table_1F_BinEdges);
    end
end