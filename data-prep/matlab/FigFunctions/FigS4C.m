%FigS4C.m

function FigS4C(subj_figs,summary_data_path,nwb)
    clearvars -except subj_session_id summary_data_path subj_figs primary_experiments_table subj nwb output_path
    if contains(subj_figs,' S4c')
        
        traces_tbl = readtable(strcat(summary_data_path,'\IndividualFigures\FigS4\C\Flux_Diameter_Example_Traces_Supp4C.csv'));
        edges_tbl = readtable(strcat(summary_data_path,'\IndividualFigures\FigS4\C\Flux_Diameter_Example_Edges_Supp4C.csv'));
    
        diam_trace = traces_tbl.d_trace_n;
        flux_trace = traces_tbl.flux_trace_n;
        diam_edges = edges_tbl.d_n_edge;
        flux_edges = edges_tbl.flux_n_edge;
        %             figure; histogram2(diam_trace,flux_trace,diam_edges,flux_edges,'DisplayStyle','tile');
    
        %Assign to dynamic table: Pia
        col1 = types.hdmf_common.VectorData( ...
            'description', 'normalized diam trace', ...
            'data', diam_trace);
        col1_len = length(col1.data);
        col2 = types.hdmf_common.VectorData( ...
            'description', 'normalized flux trace', ...
            'data', flux_trace);
        table_S4C_Traces = types.hdmf_common.DynamicTable( ...
            'description', 'analysis table', ...
            'normalized diam trace', col1, ...
            'normalized flux trace', col2, ...
            'id', types.hdmf_common.ElementIdentifiers('data', linspace(1,col1_len,col1_len)) ...
            );
        nwb.analysis.set('FluxDiameterModulationJointDistributionTracesReaChRS4C', table_S4C_Traces);
    
        %Assign to dynamic table
        col1 = types.hdmf_common.VectorData( ...
            'description', 'normalized diam bin edges', ...
            'data', diam_edges);
        col1_len = length(col1.data);
        col2 = types.hdmf_common.VectorData( ...
            'description', 'normalized flux bin edges', ...
            'data', flux_edges);
        table_S4C_BinEdges = types.hdmf_common.DynamicTable( ...
            'description', 'analysis table', ...
            'normalized diam bin edges', col1, ...
            'normalized flux bin edges', col2, ...
            'id', types.hdmf_common.ElementIdentifiers('data', linspace(1,col1_len,col1_len)) ...
            );
        nwb.analysis.set('FluxDiameterModulationJointDistributionEdgesReaChRS4C', table_S4C_BinEdges);
    end
end