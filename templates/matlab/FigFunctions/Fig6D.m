%Fig6D.m
% Dynamic Table
% ref: https://www.mathworks.com/help/images/ref/getimage.html

function Fig6D(subj_figs,summary_data_path,nwb)
    clearvars -except subj_session_id summary_data_path subj_figs primary_experiments_table subj nwb output_path
    % in figure_save->fig
    if contains(subj_figs,' 6d')
    
        %REMOVE HARD-CODING; USE summary_data_path
        openfig(strcat(summary_data_path,'\IndividualFigures\Fig6\D\Corr_spatial_rest.fig'))
    
        caxis([-0.82 0.82]);
        I = getimage;
        
        col1 = types.hdmf_common.VectorData( ...
            'description', 'Pial Mode 1 Neu Mode 1-10', ...
            'data', I(:,1));
        col1_len = length(col1.data);
        col2 = types.hdmf_common.VectorData( ...
            'description', 'Pial Mode 2 Neu Mode 1-10', ...
            'data', I(:,2));
        col3 = types.hdmf_common.VectorData( ...
            'description', 'Pial Mode 3 Neu Mode 1-10', ...
            'data', I(:,3));
        col4 = types.hdmf_common.VectorData( ...
            'description', 'Pial Mode 4 Neu Mode 1-10', ...
            'data', I(:,4));
        col5 = types.hdmf_common.VectorData( ...
            'description', 'Pial Mode 5 Neu Mode 1-10', ...
            'data', I(:,5));
        col6 = types.hdmf_common.VectorData( ...
            'description', 'Pial Mode 6 Neu Mode 1-10', ...
            'data', I(:,6));
        col7 = types.hdmf_common.VectorData( ...
            'description', 'Pial Mode 7 Neu Mode 1-10', ...
            'data', I(:,7));
        col8 = types.hdmf_common.VectorData( ...
            'description', 'Pial Mode 8 Neu Mode 1-10', ...
            'data', I(:,8));
        col9 = types.hdmf_common.VectorData( ...
            'description', 'Pial Mode 9 Neu Mode 1-10', ...
            'data', I(:,9));
        col10 = types.hdmf_common.VectorData( ...
            'description', 'Pial Mode 10 Neu Mode 1-10', ...
            'data', I(:,10));
        table_6D_SpatialCorrMat = types.hdmf_common.DynamicTable( ...
            'description', 'analysis table', ...
            'Pial Mode 1 Neu Mode 1-10', col1, ...
            'Pial Mode 2 Neu Mode 1-10', col2, ...
            'Pial Mode 3 Neu Mode 1-10',col3,...
            'Pial Mode 4 Neu Mode 1-10',col4,...
            'Pial Mode 5 Neu Mode 1-10',col5,...
            'Pial Mode 6 Neu Mode 1-10',col6,...
            'Pial Mode 7 Neu Mode 1-10',col7,...
            'Pial Mode 8 Neu Mode 1-10',col8,...
            'Pial Mode 9 Neu Mode 1-10',col9,...
            'Pial Mode 10 Neu Mode 1-10',col10,...
            'id', types.hdmf_common.ElementIdentifiers('data', linspace(1,col1_len,col1_len)) ...
            );
        nwb.analysis.set('GRaFTSpatialCorrMat6D', table_6D_SpatialCorrMat);
        close all
    end
end