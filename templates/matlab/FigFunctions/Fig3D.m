%Fig3D.m
% Dynamic Table

function Fig3D(subj_figs,summary_data_path,nwb)
    clearvars -except subj_session_id summary_data_path subj_figs primary_experiments_table subj nwb output_path
    if contains(subj_figs,' 3d')
    
        table = readtable(strcat(summary_data_path, '\IndividualFigures\Fig3\D\CaDCrossCorrSummary.csv'));
        
        meandiam = table.meandiam;
        medcorr = table.mediancorr;
        medlag = table.medianlag;
    
        %Create dynamic table
        col1 = types.hdmf_common.VectorData( ...
            'description', 'Mean Diameter (um)', ...
            'data', meandiam);
        col1_len = length(col1.data);
        col2 = types.hdmf_common.VectorData( ...
            'description', 'Ca-Diameter Peak Correlation', ...
            'data', medcorr);
        col3 = types.hdmf_common.VectorData( ...
            'description', 'Ca-Diameter Lag at Peak Correlation (s)', ...
            'data', medlag);
        table_3D = types.hdmf_common.DynamicTable( ...
            'description', 'analysis table', ...
            'Diameter', col1, ...
            'Correlation', col2, ...
            'Lag',col3,...
            'id', types.hdmf_common.ElementIdentifiers('data', linspace(1,col1_len,col1_len)) ...
            );
        table_3D;
    
        nwb.analysis.set('CaDiameterCrossCorrelation3D', table_3D);
    end
end