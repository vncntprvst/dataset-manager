%Fig6B.m
% Dynamic Table
% ref: https://www.mathworks.com/matlabcentral/answers/383567-how-to-extract-x-y-data-values-from-matlab-figure

function Fig6B(subj_figs,summary_data_path,nwb)
    clearvars -except subj_session_id summary_data_path subj_figs primary_experiments_table subj nwb output_path
    if contains(subj_figs,' 6b')
    
        openfig(strcat(summary_data_path, "\IndividualFigures\Fig6\B\D_ves_rest_meanspec_0_02.fig"));
    
        h = findobj(gca,'Type','line')
        x=get(h,'Xdata');
        y=get(h,'Ydata');
        xsave = flip(x,1);
        ysave = flip(y,1);
        %Create dynamic table
        col1 = types.hdmf_common.VectorData( ...
            'description', 'Frequency (Hz)', ...
            'data', xsave{1});
        col1_len = length(col1.data);
        col2 = types.hdmf_common.VectorData( ...
            'description', 'Mode 1 Power', ...
            'data', ysave{1});
        col3 = types.hdmf_common.VectorData( ...
            'description', 'Mode 2 Power', ...
            'data', ysave{2});
        col4 = types.hdmf_common.VectorData( ...
            'description', 'Mode 3 Power', ...
            'data', ysave{3});
        col5 = types.hdmf_common.VectorData( ...
            'description', 'Mode 4 Power', ...
            'data', ysave{4});
        col6 = types.hdmf_common.VectorData( ...
            'description', 'Mode 5 Power', ...
            'data', ysave{5});
        col7 = types.hdmf_common.VectorData( ...
            'description', 'Mode 6 Power', ...
            'data', ysave{6});
        col8 = types.hdmf_common.VectorData( ...
            'description', 'Mode 7 Power', ...
            'data', ysave{7});
        col9 = types.hdmf_common.VectorData( ...
            'description', 'Mode 8 Power', ...
            'data', ysave{8});
        col10 = types.hdmf_common.VectorData( ...
            'description', 'Mode 9 Power', ...
            'data', ysave{9});
        col11 = types.hdmf_common.VectorData( ...
            'description', 'Mode 10 Power', ...
            'data', ysave{10});
        table_6B_VesselSpec = types.hdmf_common.DynamicTable( ...
            'description', 'analysis table', ...
            'Frequency (Hz)', col1, ...
            'Mode 1 Power', col2, ...
            'Mode 2 Power',col3,...
            'Mode 3 Power',col4,...
            'Mode 4 Power',col5,...
            'Mode 5 Power',col6,...
            'Mode 6 Power',col7,...
            'Mode 7 Power',col8,...
            'Mode 8 Power',col9,...
            'Mode 9 Power',col10,...
            'Mode 10 Power',col11,...
            'id', types.hdmf_common.ElementIdentifiers('data', linspace(1,col1_len,col1_len)) ...
            );
        nwb.analysis.set('VesselGRAFTModeSpectra6B', table_6B_VesselSpec);
        close all
    end
end